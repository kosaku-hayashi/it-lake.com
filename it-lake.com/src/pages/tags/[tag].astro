---
import { getCollection, type CollectionEntry } from 'astro:content';
import { tagToSlug, slugToTag } from '../../scripts/tagAndSlugConverter.ts';
import TagIcon from '../../components/TagIcon.astro';
import PostCard from "../../components/PostCard.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";


export async function getStaticPaths() {
  const allPosts = await getCollection('posts');
  const uniqueTags = [...new Set(allPosts.map((post) => post.data.tags).flat())];
  return uniqueTags.map((tag) => {
    const filteredPosts = allPosts.filter((post) => post.data.tags.includes(tag));
    const slug = tagToSlug(tag);
    return {
        params: {tag: slug},
        props: {posts: filteredPosts},
    }
  })
}

const { tag } = Astro.params;
const { posts } = Astro.props;
const displayTag = slugToTag(tag);
---

<BaseLayout pageTitle=''>
    <div style="display: flex; flex-direction: row; align-items: center; gap:10px">
        <TagIcon width="32" height="32"></TagIcon>
        <h1>{displayTag}</h1>
    </div>
    <ul class="unstyled-list">
        {
          posts.map((post) => (
            <li>
                <PostCard post={post}></PostCard>
            </li>
          ))
        }
    </ul>
</BaseLayout>